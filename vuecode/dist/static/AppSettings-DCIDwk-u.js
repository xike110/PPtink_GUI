import{_ as ve,r as v,a as ce,o as me,c as P,w as fe,b as p,e as r,g as h,d as s,f as o,A as f,u as l,a8 as F,i as Q,a7 as R,m as j,S as L,a9 as K,aa as U,ab as B,ac as ge,t as $,C as E,ad as we,ae as g,af as _,ag as ye,ah as be,ai as he,aj as k,ak as H,p as ke,q as G,F as Ve,l as Se,R as Ce,al as c,x as u}from"./zh-cn-Vbf23Fjh.js";const Ee={class:"macos-window"},xe={class:"content-area"},Ae={class:"section-container"},Ue={class:"settings-content"},_e={class:"settings-header"},ze={class:"tabs"},Ne={key:0},$e={class:"settings-section"},Oe={class:"switch"},Te={class:"settings-section"},qe={class:"switch"},Ie={key:1,class:"startup-manage-section"},De={key:0,class:"filter-container"},Me={key:0,class:"filter-info"},Fe={key:1,class:"startup-loading"},Le={class:"empty-placeholder"},Be={key:1},Je={key:2},Pe={key:3,class:"pagination-container"},Qe={key:0,class:"formdata-error"},Re={class:"dialog-footer"},je={class:"dialog-footer"},Ke={key:2,class:"help-section"},He={class:"faq-container"},Ge={class:"faq-question"},We={class:"faq-answer"},Xe={key:0,class:"faq-empty"},Ye={key:3,class:"about-section"},Ze=["innerHTML"],et={__name:"AppSettings",setup(tt){const O=Ce("appConfig"),w=v("settings"),i=ce({createShortcut:!1,autostart:!1,directoryPath:"未选择目录"}),T=v([]),q=v(!1),z=v(!1),n=v({}),J=v(null),x=v(!1),N=v(null),V=v(""),S=v(""),W={guiname:[{required:!0,message:"请输入应用名称",trigger:"blur"}],sign:[{required:!0,message:"请输入应用标识",trigger:"blur"}],main:[{required:!0,message:"请输入应用入口",trigger:"blur"}],menuname:[{required:!0,message:"请输入菜单名称",trigger:"blur"}]},I=async()=>{q.value=!0;try{if(!window.pywebview||!window.pywebview.api){console.error("pywebview API尚未初始化，无法加载启动应用"),q.value=!1;return}const t=await window.pywebview.api.getStartupApps();T.value=t||[],C.value=1}catch(t){console.error("加载启动应用列表出错:",t)}finally{q.value=!1}},X=async t=>{try{await window.pywebview.api.updateStartupApp({id:t.id,enabled:t.enabled})?d("成功","已更新启动状态","success"):(t.enabled=!t.enabled,d("错误","更新启动状态失败","error"))}catch(e){t.enabled=!t.enabled,console.error("更新启动状态出错:",e),d("错误",`更新启动状态出错: ${e}`,"error")}},Y=async t=>{try{t.bkgrdstat&&(t.autoclose=!0),await window.pywebview.api.updateStartupApp({id:t.id,bkgrdstat:t.bkgrdstat,autoclose:t.autoclose})?d("成功","已更新后台运行状态","success"):(t.bkgrdstat=!t.bkgrdstat,t.bkgrdstat===!1||(t.autoclose=!1),d("错误","更新后台运行状态失败","error"))}catch(e){t.bkgrdstat=!t.bkgrdstat,t.bkgrdstat===!1||(t.autoclose=!1),console.error("更新后台运行状态出错:",e),d("错误",`更新后台运行状态出错: ${e}`,"error")}},Z=async t=>{try{await window.pywebview.api.updateStartupApp({id:t.id,autoclose:t.autoclose})?d("成功","已更新结束关闭状态","success"):(t.autoclose=!t.autoclose,d("错误","更新结束关闭状态失败","error"))}catch(e){t.autoclose=!t.autoclose,console.error("更新结束关闭状态出错:",e),d("错误",`更新结束关闭状态出错: ${e}`,"error")}},ee=t=>{n.value=JSON.parse(JSON.stringify(t));try{n.value.formdata?V.value=JSON.stringify(n.value.formdata,null,2):V.value="{}",S.value=""}catch(e){console.error("转换formdata失败:",e),V.value="{}",S.value="原始数据格式无效，已重置为空对象"}z.value=!0},te=async()=>{try{try{if(V.value.trim()){const e=JSON.parse(V.value);n.value.formdata=e}else n.value.formdata={};S.value=""}catch(e){S.value="JSON格式无效，请检查语法",console.error("JSON解析错误:",e);return}await J.value.validate(),await window.pywebview.api.updateStartupApp(n.value)?(d("成功","已保存启动应用设置","success"),z.value=!1,await I()):d("错误","保存启动应用设置失败","error")}catch(t){console.error("保存启动应用设置出错:",t),typeof t=="string"&&d("错误",`保存启动应用设置出错: ${t}`,"error")}},ae=t=>{N.value=t,x.value=!0},le=async()=>{try{if(!N.value||!N.value.id)return;await window.pywebview.api.deleteStartupApp(N.value.id)?(d("成功","已删除启动应用","success"),x.value=!1,await I()):d("错误","删除启动应用失败","error")}catch(t){console.error("删除启动应用出错:",t),d("错误",`删除启动应用出错: ${t}`,"error")}finally{x.value=!1}},d=(t,e,a="info")=>{c({message:e,type:a==="danger"?"error":a,duration:a==="error"||a==="danger"?3e3:1500})};me(()=>{setTimeout(()=>{se(),w.value==="startupManage"&&I()},500)});const D=t=>{w.value=t,t==="startupManage"&&I()},se=async()=>{try{if(!window.pywebview||!window.pywebview.api){console.error("pywebview API尚未初始化");return}const t=await window.pywebview.api.checkShortcutExists();i.createShortcut=t;const e=await window.pywebview.api.checkAutostartExists();i.autostart=e}catch(t){console.error("初始化设置时出错:",t)}},oe=async()=>{if(i.createShortcut)try{await window.pywebview.api.createShortcut()?c({message:"已成功创建桌面快捷方式!",type:"success",duration:1500}):(i.createShortcut=!1,c({message:"创建桌面快捷方式失败。",type:"error",duration:2e3}))}catch(t){console.error("创建桌面快捷方式时出错:",t),i.createShortcut=!1,c({message:"创建桌面快捷方式时出错: "+t,type:"error",duration:2e3})}else try{if(await window.pywebview.api.removeShortcut())c({message:"已成功删除桌面快捷方式!",type:"success",duration:1500});else{const e=await window.pywebview.api.checkShortcutExists();i.createShortcut=e,c({message:"删除桌面快捷方式失败。",type:"error",duration:2e3})}}catch(t){console.error("删除桌面快捷方式时出错:",t);const e=await window.pywebview.api.checkShortcutExists();i.createShortcut=e,c({message:"删除桌面快捷方式时出错: "+t,type:"error",duration:2e3})}},re=async()=>{if(i.autostart)try{await window.pywebview.api.setAutostart(!0)?c({message:"已成功设置开机启动! 下次开机时软件将自动启动并最小化到托盘。如果启动出现问题，请尝试手动启动软件。",type:"success",duration:3e3}):(i.autostart=!1,c({message:"设置开机启动失败，请检查应用权限。",type:"error",duration:2e3}))}catch(t){console.error("设置开机启动时出错:",t),i.autostart=!1,c({message:"设置开机启动时出错: "+t,type:"error",duration:2e3})}else try{if(await window.pywebview.api.setAutostart(!1))c({message:"已成功取消开机启动!",type:"success",duration:1500});else{const e=await window.pywebview.api.checkAutostartExists();i.autostart=e,c({message:"取消开机启动失败，请检查应用权限。",type:"error",duration:2e3})}}catch(t){console.error("取消开机启动时出错:",t);const e=await window.pywebview.api.checkAutostartExists();i.autostart=e,c({message:"取消开机启动时出错: "+t,type:"error",duration:2e3})}},A=v(10),C=v(1),M=P(()=>!y.value&&!b.value?T.value:T.value.filter(t=>{if(b.value==="enabled"&&!t.enabled||b.value==="disabled"&&t.enabled)return!1;if(y.value){const e=y.value.toLowerCase();return t.guiname&&t.guiname.toLowerCase().includes(e)||t.sign&&t.sign.toLowerCase().includes(e)||t.main&&t.main.toLowerCase().includes(e)||t.menuname&&t.menuname.toLowerCase().includes(e)}return!0})),ne=P(()=>{const t=(C.value-1)*A.value,e=t+A.value;return M.value.slice(t,e)}),ue=t=>{A.value=t},ie=t=>{C.value=t},y=v(""),b=v("");fe([y,b],()=>{C.value=1});const de=()=>{y.value="",b.value="",C.value=1},pe=t=>{t===!0&&(n.value.autoclose=!0)};return(t,e)=>(u(),p("div",Ee,[r("div",xe,[r("div",Ae,[r("div",Ue,[r("div",_e,[r("div",ze,[s(l(F),{type:w.value==="settings"?"primary":"info",class:"tab-tag",size:"large",effect:"light",onClick:e[0]||(e[0]=a=>D("settings"))},{default:o(()=>e[24]||(e[24]=[f(" 系统设置 ")])),_:1},8,["type"]),s(l(F),{type:w.value==="startupManage"?"primary":"info",class:"tab-tag",size:"large",effect:"light",onClick:e[1]||(e[1]=a=>D("startupManage"))},{default:o(()=>e[25]||(e[25]=[f(" 开机管理 ")])),_:1},8,["type"]),s(l(F),{type:w.value==="helpCenter"?"primary":"info",class:"tab-tag",size:"large",effect:"light",onClick:e[2]||(e[2]=a=>D("helpCenter"))},{default:o(()=>e[26]||(e[26]=[f(" 常见问题 ")])),_:1},8,["type"]),s(l(F),{type:w.value==="about"?"primary":"info",class:"tab-tag",size:"large",effect:"light",onClick:e[3]||(e[3]=a=>D("about"))},{default:o(()=>e[27]||(e[27]=[f(" 关于我们 ")])),_:1},8,["type"])])]),e[44]||(e[44]=r("div",{class:"divider-horizontal"},null,-1)),w.value==="settings"?(u(),p("div",Ne,[r("div",$e,[e[29]||(e[29]=r("h2",null,"创建桌面快捷方式",-1)),r("label",Oe,[Q(r("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=a=>i.createShortcut=a),onChange:oe},null,544),[[R,i.createShortcut]]),e[28]||(e[28]=r("span",{class:"slider round"},null,-1))])]),r("div",Te,[e[31]||(e[31]=r("h2",null,"设置开机启动",-1)),r("label",qe,[Q(r("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=a=>i.autostart=a),onChange:re},null,544),[[R,i.autostart]]),e[30]||(e[30]=r("span",{class:"slider round"},null,-1))])])])):h("",!0),w.value==="startupManage"?(u(),p("div",Ie,[T.value.length>0?(u(),p("div",De,[s(l(U),{modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=a=>y.value=a),placeholder:"搜索应用名称、标识或入口...",clearable:"",class:"filter-input"},{prefix:o(()=>[s(l(L),null,{default:o(()=>[s(l(K))]),_:1})]),_:1},8,["modelValue"]),s(l(ge),{modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=a=>b.value=a),placeholder:"启用状态",clearable:"",class:"filter-select"},{default:o(()=>[s(l(B),{label:"全部",value:""}),s(l(B),{label:"已启用",value:"enabled"}),s(l(B),{label:"未启用",value:"disabled"})]),_:1},8,["modelValue"]),y.value||b.value?(u(),p("div",Me,[r("span",null,"找到 "+$(M.value.length)+" 条匹配项",1),s(l(E),{type:"text",onClick:de},{default:o(()=>e[32]||(e[32]=[f("清除过滤")])),_:1})])):h("",!0)])):h("",!0),q.value?(u(),p("div",Fe,[s(l(L),{class:"loading-icon"},{default:o(()=>[s(l(we))]),_:1}),e[33]||(e[33]=r("span",null,"加载中...",-1))])):(u(),j(l(ye),{key:2,data:ne.value,stripe:"",style:{width:"100%"},class:"startup-table",border:"","highlight-current-row":""},{empty:o(()=>[r("div",Le,[y.value||b.value?(u(),j(l(L),{key:0},{default:o(()=>[s(l(K))]),_:1})):h("",!0),y.value||b.value?(u(),p("span",Be,"暂无匹配的启动项，请尝试更改搜索条件")):(u(),p("span",Je,"暂无启动应用数据"))])]),default:o(()=>[s(l(g),{prop:"id",label:"ID",width:"60",align:"center"}),s(l(g),{prop:"guiname",label:"应用名称","show-overflow-tooltip":""}),s(l(g),{prop:"sign",label:"应用标识","show-overflow-tooltip":""}),s(l(g),{prop:"main",label:"应用入口","show-overflow-tooltip":""}),s(l(g),{prop:"menuname",label:"菜单名称","show-overflow-tooltip":""}),s(l(g),{label:"已启用",align:"center"},{default:o(a=>[s(l(_),{modelValue:a.row.enabled,"onUpdate:modelValue":m=>a.row.enabled=m,onChange:m=>X(a.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),s(l(g),{label:"后台运行",align:"center"},{default:o(a=>[s(l(_),{modelValue:a.row.bkgrdstat,"onUpdate:modelValue":m=>a.row.bkgrdstat=m,onChange:m=>Y(a.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),s(l(g),{label:"结束关闭",align:"center"},{default:o(a=>[s(l(_),{modelValue:a.row.autoclose,"onUpdate:modelValue":m=>a.row.autoclose=m,onChange:m=>Z(a.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),s(l(g),{prop:"priority",label:"优先级",align:"center"}),s(l(g),{prop:"delay",label:"延迟(秒)",align:"center"}),s(l(g),{label:"操作",width:"180",align:"center"},{default:o(a=>[s(l(E),{size:"small",type:"primary",plain:"",onClick:m=>ee(a.row)},{default:o(()=>e[34]||(e[34]=[f(" 编辑 ")])),_:2},1032,["onClick"]),s(l(E),{size:"small",type:"danger",plain:"",onClick:m=>ae(a.row)},{default:o(()=>e[35]||(e[35]=[f(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),M.value.length>A.value?(u(),p("div",Pe,[s(l(be),{"current-page":C.value,"onUpdate:currentPage":e[8]||(e[8]=a=>C.value=a),"page-size":A.value,"onUpdate:pageSize":e[9]||(e[9]=a=>A.value=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:M.value.length,onSizeChange:ue,onCurrentChange:ie},null,8,["current-page","page-size","total"])])):h("",!0),s(l(G),{modelValue:z.value,"onUpdate:modelValue":e[21]||(e[21]=a=>z.value=a),title:"编辑启动应用",width:"600px","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:o(()=>[r("span",Re,[s(l(E),{onClick:e[20]||(e[20]=a=>z.value=!1)},{default:o(()=>e[37]||(e[37]=[f("取消")])),_:1}),s(l(E),{type:"primary",onClick:te},{default:o(()=>e[38]||(e[38]=[f("保存")])),_:1})])]),default:o(()=>[s(l(he),{model:n.value,"label-width":"100px",rules:W,ref_key:"startupFormRef",ref:J,"status-icon":""},{default:o(()=>[s(l(k),{label:"应用名称",prop:"guiname"},{default:o(()=>[s(l(U),{modelValue:n.value.guiname,"onUpdate:modelValue":e[10]||(e[10]=a=>n.value.guiname=a),spellcheck:"false",placeholder:"请输入应用名称"},null,8,["modelValue"])]),_:1}),s(l(k),{label:"应用标识",prop:"sign"},{default:o(()=>[s(l(U),{modelValue:n.value.sign,"onUpdate:modelValue":e[11]||(e[11]=a=>n.value.sign=a),spellcheck:"false",placeholder:"请输入应用标识"},null,8,["modelValue"])]),_:1}),s(l(k),{label:"应用入口",prop:"main"},{default:o(()=>[s(l(U),{modelValue:n.value.main,"onUpdate:modelValue":e[12]||(e[12]=a=>n.value.main=a),spellcheck:"false",placeholder:"请输入应用入口路径"},null,8,["modelValue"])]),_:1}),s(l(k),{label:"菜单名称",prop:"menuname"},{default:o(()=>[s(l(U),{modelValue:n.value.menuname,"onUpdate:modelValue":e[13]||(e[13]=a=>n.value.menuname=a),spellcheck:"false",placeholder:"请输入菜单名称"},null,8,["modelValue"])]),_:1}),s(l(k),{label:"已启用"},{default:o(()=>[s(l(_),{modelValue:n.value.enabled,"onUpdate:modelValue":e[14]||(e[14]=a=>n.value.enabled=a)},null,8,["modelValue"])]),_:1}),s(l(k),{label:"后台运行"},{default:o(()=>[s(l(_),{modelValue:n.value.bkgrdstat,"onUpdate:modelValue":e[15]||(e[15]=a=>n.value.bkgrdstat=a),onChange:pe},null,8,["modelValue"])]),_:1}),s(l(k),{label:"结束关闭"},{default:o(()=>[s(l(_),{modelValue:n.value.autoclose,"onUpdate:modelValue":e[16]||(e[16]=a=>n.value.autoclose=a)},null,8,["modelValue"])]),_:1}),s(l(k),{label:"优先级",prop:"priority"},{default:o(()=>[s(l(H),{modelValue:n.value.priority,"onUpdate:modelValue":e[17]||(e[17]=a=>n.value.priority=a),spellcheck:"false",min:0,max:999},null,8,["modelValue"])]),_:1}),s(l(k),{label:"延迟(秒)",prop:"delay"},{default:o(()=>[s(l(H),{modelValue:n.value.delay,"onUpdate:modelValue":e[18]||(e[18]=a=>n.value.delay=a),spellcheck:"false",min:0,max:300},null,8,["modelValue"])]),_:1}),s(l(k),{label:"应用参数",prop:"formdata"},{default:o(()=>[s(l(U),{modelValue:V.value,"onUpdate:modelValue":e[19]||(e[19]=a=>V.value=a),type:"textarea",spellcheck:"false",rows:5,placeholder:"请输入JSON格式的应用参数",class:ke({"is-invalid":S.value})},null,8,["modelValue","class"]),S.value?(u(),p("div",Qe,$(S.value),1)):h("",!0),e[36]||(e[36]=r("div",{class:"formdata-tips"},[r("small",null,'JSON格式，例如: {"key": "value", "setting": true}')],-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),s(l(G),{modelValue:x.value,"onUpdate:modelValue":e[23]||(e[23]=a=>x.value=a),title:"确认删除",width:"30%",center:""},{footer:o(()=>[r("span",je,[s(l(E),{onClick:e[22]||(e[22]=a=>x.value=!1)},{default:o(()=>e[39]||(e[39]=[f("取消")])),_:1}),s(l(E),{type:"danger",onClick:le},{default:o(()=>e[40]||(e[40]=[f("确认删除")])),_:1})])]),default:o(()=>{var a;return[r("span",null,'确定要删除启动项 "'+$((a=N.value)==null?void 0:a.guiname)+'" 吗？',1)]}),_:1},8,["modelValue"])])):h("",!0),w.value==="helpCenter"?(u(),p("div",Ke,[e[41]||(e[41]=r("h2",null,"常见问题",-1)),e[42]||(e[42]=r("div",{class:"macos-divider"},null,-1)),r("div",He,[(u(!0),p(Ve,null,Se(l(O).ASKED_QUESTIONS,(a,m)=>(u(),p("div",{key:m,class:"faq-item"},[r("div",Ge,[r("strong",null,"问："+$(a.question),1)]),r("div",We,"答："+$(a.answer),1)]))),128)),!l(O).ASKED_QUESTIONS||l(O).ASKED_QUESTIONS.length===0?(u(),p("div",Xe," 暂无常见问题 ")):h("",!0)])])):h("",!0),w.value==="about"?(u(),p("div",Ye,[e[43]||(e[43]=r("h2",null,"关于我们",-1)),r("div",{innerHTML:l(O).ABOUTUS},null,8,Ze)])):h("",!0)])])])]))}},lt=ve(et,[["__scopeId","data-v-30091bd5"]]);export{lt as default};
